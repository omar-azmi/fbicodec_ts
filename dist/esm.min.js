var A=e=>e.length===0,ee=String.fromCharCode,{from:re,isArray:te,of:se}=Array,{isInteger:ae,MAX_VALUE:ne,NEGATIVE_INFINITY:I,POSITIVE_INFINITY:ie}=Number,{assign:oe,defineProperty:de,entries:le,fromEntries:ue,keys:ce,getPrototypeOf:pe,values:_e}=Object,be=Date.now,{iterator:he,toStringTag:ye}=Symbol,f=e=>{if(e[2]==="c")return Uint8ClampedArray;switch(e=e[0]+e[1],e){case"u1":return Uint8Array;case"u2":return Uint16Array;case"u4":return Uint32Array;case"i1":return Int8Array;case"i2":return Int16Array;case"i4":return Int32Array;case"f4":return Float32Array;case"f8":return Float64Array;default:return console.error('an unrecognized typed array type `"${type}"` was provided'),Uint8Array}},B=()=>new Uint8Array(Uint32Array.of(1).buffer)[0]===1,_=B(),g=(e,r)=>{let t=e.byteLength,s=new Uint8Array(t),a=r;for(let n=0;n<a;n++){let o=a-1-n*2;for(let i=n;i<t+n;i+=a)s[i]=e[i+o]}return s},h=(...e)=>{let r=[0];for(let s of e)r.push(r[r.length-1]+s.length);let t=new Uint8Array(r.pop());for(let s of e)t.set(s,r.shift());return t},w=new TextEncoder,v=new TextDecoder,E=e=>w.encode(e+"\0"),U=(e,r=0)=>{let t=e.indexOf(0,r),s=e.subarray(r,t);return[v.decode(s),s.length+1]},N=e=>w.encode(e),T=(e,r=0,t)=>{let s=t===void 0?void 0:r+t,a=e.subarray(r,s);return[v.decode(a),a.length]},F=e=>e,j=(e,r=0,t)=>{let s=t===void 0?void 0:r+t,a=e.slice(r,s);return[a,a.length]},k=(e,r)=>{let[t,s,a]=r,n=f(r),o=parseInt(s),i=!!(a==="l"&&_||a==="b"&&!_||o===1),d=n.from(e);if(d instanceof Uint8Array)return d;let l=new Uint8Array(d.buffer);return i?l:g(l,o)},m=(e,r=0,t,s)=>{let[a,n,o]=t,i=parseInt(n),d=!!(o==="l"&&_||o==="b"&&!_||i===1),l=s?i*s:void 0,c=e.slice(r,l?r+l:void 0),b=c.length,x=f(t),S=new x(d?c.buffer:g(c,i).buffer);return[Array.from(S),b]},O=(e,r)=>k([e],r),P=(e,r=0,t)=>{let[s,a]=m(e,r,t,1);return[s[0],a]},{isFinite:fe,parseInt:ge}=Number,{ceil:we}=Math,y=class{},p=class extends y{lost},C=class extends y{},u=class extends p{},V=class extends u{item_step;constructor(e){super(),this.item_step=e}forward(e){let{bin:r,pos:t,args:{length:s,item:a}}=e,n=r.byteLength,o=[],i=0,d=s<0?I:0;for(;d<s&&t+i<n;){let{val:l,len:c}=this.next_forward(r,t+i,a);i+=c,o.push(l),d++}return{val:o,len:i}}next_forward(e,r,t){return this.item_step.forward({bin:e,pos:r,args:t})}backward(e){let r=this.item_step,t=[],s=e.val,a;for(let n of s){let{bin:o,args:i}=r.backward({val:n});t.push(o),a??=i}return{bin:h(...t),pos:0,args:{length:t.length,item:a}}}},L=class extends u{head_step;body_step;constructor(e,r){super(),this.head_step=e,this.body_step=r}forward(e){let{bin:r,pos:t,args:{head:s,body:a}={}}=e,n=this.head_step,o=this.body_step,{val:i,len:d}=n.forward({bin:r,pos:t,args:s}),{val:l,len:c}=o.forward({bin:r,pos:t+d,args:{length:i,...a}});return{val:l,len:d+c}}backward(e){let{bin:r,args:t}=this.body_step.backward(e),{length:s,...a}=t,{bin:n,args:o}=this.head_step.backward({val:s});return{bin:h(n,r),pos:0,args:{head:o,body:a}}}},M=class extends u{entry_steps;constructor(e){super(),this.entry_steps=e}forward(e){let{bin:r,pos:t,args:s={}}=e;return this.partial_forward(r,t,s)}partial_forward(e,r,t,s=0,a){let n=this.entry_steps.slice(s,a),o={},i=0;for(let[d,l]of n){let{val:c,len:b}=l.forward({bin:e,pos:r+i,args:t[d]});i+=b,o[d]=c}return{val:o,len:i}}backward(e){let{bins:r,args:t}=this.partial_backward(e.val);return{bin:h(...r),pos:0,args:t}}partial_backward(e,r=0,t){let s=this.entry_steps.slice(r,t),a=[],n={};for(let[o,i]of s){let{bin:d,args:l}=i.backward({val:e[o]});n[o]=l,a.push(d)}return{bins:a,args:n}}},Y=class extends p{steps;constructor(...e){super(),this.steps=e}forward(e){let r=this.steps.length,t=e;for(let s=0;s<r;s++)t=this.next_forward(t,s);return t}next_forward(e,r){return this.steps[r].forward(e)}backward(e){let r=this.steps.length,t=e;for(let s=0;s<r;s++)t=this.next_backward(t,s);return t}next_backward(e,r){return this.steps.at(-1-r).backward(e)}},z=class extends u{state;states;constructor(e,r){super(),this.state=r,this.states=e}forward(e){return this.states[this.state].forward(e)}backward(e){return this.states[this.state].backward(e)}},D=class extends u{default_state;states;stack=[];constructor(e,r){super(),this.default_state=r,this.states=e}forward(e){return this.states[this.pop()].forward(e)}backward(e){return this.states[this.pop()].backward(e)}push(...e){this.stack.push(...e)}pop(){let e=this.stack;return A(e)?this.default_state:e.pop()}},G=class extends u{conditions;default_step;constructor(e,r){super(),this.conditions=e,this.default_step=r}forward(e){for(let[r,,t]of this.conditions)if(r(e))return t.forward(e);return this.default_step.forward(e)}backward(e){for(let[,r,t]of this.conditions)if(r(e))return t.backward(e);return this.default_step.backward(e)}},W=class extends u{forward(e){let{bin:r,pos:t}=e,[s,a]=U(r,t);return{val:s,len:a}}backward(e){return{bin:E(e.val),pos:0}}},X=class extends u{kind;constructor(e){super(),this.kind=e}forward(e){let{bin:r,pos:t}=e,[s,a]=P(r,t,this.kind);return{val:s,len:a}}backward(e){return{bin:O(e.val,this.kind),pos:0}}},q=class extends u{forward(e){let{bin:r,pos:t,args:{length:s}}=e,[a,n]=T(r,t,s>=0?s:void 0);return{val:a,len:n}}backward(e){let r=N(e.val),t=r.length;return{bin:r,pos:0,args:{length:t}}}},H=class extends u{kind;constructor(e){super(),this.kind=e}forward(e){let{bin:r,pos:t,args:{length:s}}=e,[a,n]=m(r,t,this.kind+"[]",s>=0?s:void 0);return{val:a,len:n}}backward(e){let r=e.val,t=r.length;return{bin:k(r,this.kind+"[]"),pos:0,args:{length:t}}}},R=class extends u{forward(e){let{bin:r,pos:t,args:{length:s}}=e,[a,n]=j(r,t,s>=0?s:void 0);return{val:a,len:n}}backward(e){let r=F(e.val),t=r.length;return{bin:r,pos:0,args:{length:t}}}},$=class extends u{step;args;priority;constructor(e,r,t=1){super(),this.step=e,this.args=r,this.priority=t}forward(e){let{bin:r,pos:t,args:s={}}=e,a=this.step,n=this.args,o=this.priority,i=o>0?{...s,...n}:{...n,...s};return a.forward({bin:r,pos:t,args:i})}backward(e){return this.step.backward(e)}},J=class extends p{forward(e){return e.val}backward(e){return{val:e}}},K=class extends p{forward(e){return{val:e,len:void 0}}backward(e){return e.val}},Q=class extends p{forward(e){return e.bin}backward(e){return{bin:e,pos:0,args:void 0}}},Z=class extends p{forward(e){return{bin:e,pos:0,args:void 0}}backward(e){return e.bin}};export{V as BinaryArrayStep,R as BinaryBytesStep,W as BinaryCStringStep,G as BinaryConditionalStep,$ as BinaryDefaultArgs,L as BinaryHeaderLengthedStep,Q as BinaryInputUnwrapStep,Z as BinaryInputWrapStep,z as BinaryMultiStateStep,H as BinaryNumberArrayStep,X as BinaryNumberStep,J as BinaryOutputUnwrapStep,K as BinaryOutputWrapStep,u as BinaryPureStep,M as BinaryRecordStep,D as BinaryStackedStateStep,C as BinaryStep,q as BinaryStringStep,p as PureStep,Y as SequentialSteps,y as Step};
